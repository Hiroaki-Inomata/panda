\section{DB定義体}

DB定義体とは、データベースを使うにあたって、そのデータベースのスキーマや
アクセス方法を記述したものである。実際の内容は、

\begin{itemize}
\item	{\bf レコード定義}
\item	{\bf プライマリキー定義}
\item	{\bf パス定義}
\end{itemize}

によって構成されている。このうち必須な項目は、レコード定義である。

\subsection{構文}

\begin{verbatim}
DB定義体        ::= レコード定義 プライマリキー定義 パス定義 .
プライマリキー定義  ::= "primary" "{" キー要素並び行 "}" ";" .
キー要素並び行  ::= キー要素並び ";" .
キー要素並び    ::= キー要素名 | キー要素名 "," キー要素並び .
キー要素名      ::= 名前 .
パス定義        ::= "path" パス名 "{" 機能並び "}" ";" .
パス名          ::= 名前 .
機能並び        ::= 機能 | 機能 機能並び .
機能            ::= 機能名 "{" スクリプト並び "}" ";" .
スクリプト並び  ::= スクリプト行 | スクリプト行 スクリプトL並び .
スクリプト行    ::= スクリプト命令 ";" .
\end{verbatim}


\subsection{レコード定義}

データベースレコードの定義を行う。定義方法については、\label{sec:DD}を
参照のこと。

スクリプト中のデータ参照では、階層構造をもったデータの参照が出来ないこ
とが多いが、本システムでは、スクリプトを処理する部分で処理を行っている
ため、擬似的に階層構造も持つことが出来るようになっている。以下に例を示す。

\begin{verbatim}
adrs    {
    name    char(40);
    tel     char(13);
    mail    {
        home    char(64); ※1
        office  char(64);
    };
    toll    number(5,1);
    weight  number(5,1);
    address char(80)[3]; ※2
    tv      char[], virtual; ※3

};
\end{verbatim}

この例で、※1は構造体メンバである。これをDB定義の中で参照するには、`.'で
区切って表現する。すなわち、`mail.home'のように表される。

※2は配列である。これは個々の要素を見る時には、`address[1]'のように表現
する。配列全体は`address'のように表現される。配列の添字は1から始まる。

※3は属性の指定である。属性に"virtual"とつけることにより、データ処理や
COPY句の生成は行われるが、テーブルの項目は作成しない。これは、スクリプ
ト用インターフェイス変数をテーブルと関係なしに作成することが出来る。

\subsection{プライマリキー定義}

プライマリキー制約を与えるための要素を指定する。以下に例を示す。

\begin{verbatim}
primary {
    name;
};
\end{verbatim}

複数の要素を連結してプライマリキーにする場合は、

\begin{verbatim}
primary {
    name, mail.home;
};
\end{verbatim}

のように、`,'で区切って表現される。この例のように、構造の要素も使える。

\subsection{パス定義}

データベースのアクセス方法を定義する。予約語`path'の後につけた名前がパス
名である。

パス定義には、データベースをアクセスする手段を定義する。アクセス方法は
スクリプトで記述するが、そのスクリプトがどのように実行されるかは、デー
タベースのハンドラルーチンの実装に依存する。

以下に例を示す。この例では、スクリプトにSQLを使っている。

\begin{verbatim}
path    tel {
    SELECT  {
        DECLARE adrs_tel_csr CURSOR FOR
        SELECT  *
            WHERE
                tel = :tel
        ;
    };
};
\end{verbatim}

以下の例は、スクリプトにshellを使う例である。

\begin{verbatim}
path    do  {
    ECHO    {
        echo :arg;
    };
    COMMAND {
        :name :arg;
    };
    CAT {
        echo :arg;
        cat :arg;
    };
};
\end{verbatim}

\subsection{パス定義におけるスクリプトの記述方法}

スクリプトの実行についての実装は、それぞれのハンドラの実装のしかたに依
る。多くの場合、任意の命令を任意の長さで記述出来るはずである(そう実装
されていることが多い)。スクリプト内変数名はそのまま、ホスト変数名には
\verb|:|を前置する。このホスト変数名参照の時も構造の要素が使える。

文が区切られた場合、実際のデータベース処理は、この区切られた単位で行わ
れる。

\verb|:*|はそのDBレコードの全ホスト変数を表現する。これはSQLの全カラム
指定の\verb|*|に対応したものである。この指定が実際に使えるかどうかは、
ハンドラの実装に依る。
