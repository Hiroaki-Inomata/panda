\chapter{データベースアクセス}

\section{基本事項}

\subsection{概要}

本システムのデータベースアクセスは、言語依存のデータベースアクセスルー
チンからエントリし、データベースアクセスハンドラを介して行われる。この
ハンドラは、本システムのモジュールとして実装され、DB groupの定義の時に
指定する。

\section{PostgreSQLハンドラ}

\subsection{概要}

本ハンドラは、PostgreSQLを、libpqを介してTCP/IP接続によってアクセスを
行う。現在のところ、接続するユーザは、DB group定義に書かれたユーザか、
無名ユーザである。

\subsection{基本機能}

以下の機能が標準で提供されている。これらは、path定義に機能を記述するこ
とにより、上書きされる。

\begin{itemize}
\item	{\tt DBFETCH}

レコード(タプル)の全カラム取得を行う。この時のカーソル名は、
\begin{verbatim}
<テーブル名> + '_' + <パス名> + '_' + "scr"
\end{verbatim}

であることを仮定している。そのため、標準のDBFETCHを使う場合は、
selectionを行うときにカーソルはこの名前でなくてはならない。

\item	{\tt DBUPDATE}

タプルの全カラム更新である。位置指定はプライマリキーを用いる。

\item	{\tt DBDELETE}

当該タプルの削除である。位置指定はプライマリキーを用いる。

\item	{\tt DBINSERT}

タプルの全カラム指定の挿入である。

\end{itemize}

基本機能の{\tt DBFETCH}を使う場合、あらかじめカーソルをセットしなくて
はならない。カーソルをセットする機能の名前としては、{\tt DBSELECT}が推
奨されている。処理の具体的な内容は定義されていないので、必ず定義しなく
てはならない。

\subsection{機能定義手続きのスクリプトの文法}

既定の機能を使わない場合は、機能をスクリプトで記述しなくてはならない。
PostgreSQLをアクセスする際のスクリプトは、PostgreSQLに規定されたSQL文
である。

タプルを受け取る命令(FETCH等)の場合、INTOの後の変数には`:*'と指定する
ことにより、タプルの全項目をレコード領域に取り込むことが出来る。

\section{Shellハンドラ}

\subsection{概要}

本ハンドラは、shellを起動する。現在のところ、実行するユーザは、apsが起
動されたユーザと同じである。

\subsection{基本機能}

本ハンドラには、既定の基本機能はない。

\subsection{機能定義手続きのスクリプトの文法}

Shelをアクセスする際のスクリプトは、\verb|/bin/sh|に既定されたshellの
文である。

現在のところ、このハンドラではデータの受け取りは記述出来ない。
